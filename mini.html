<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Crossword</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background:#fff; min-height:100vh; display:flex; flex-direction:column; }

    .header{display:flex;align-items:center;padding:1.5rem;background:#fff;border-bottom:1px solid #e0e0e0;}
    .back-btn{font-size:2rem;cursor:pointer;color:#000;text-decoration:none;padding-right:.75rem;line-height:1;display:flex;align-items:center;gap:.5rem;}
    .back-text{font-size:1.02rem;font-weight:400;line-height:1;margin-top:4px;}

    .puzzle-container{flex:1;width:100%;padding:1rem;display:flex;justify-content:center;align-items:flex-start;}
    .pm-embed-div{width:100%;max-width:900px;}

    /* Victory Popup */
    .victory-popup{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:10000;display:none;align-items:center;justify-content:center;}
    .victory-popup.show{display:flex;}
    .victory-content{background:#fff;padding:3rem 2.5rem;border-radius:16px;text-align:center;max-width:400px;margin:0 1rem;}
    .victory-message{font-size:2rem;font-weight:700;margin-bottom:2rem;color:#000;}
    .back-to-puzzles-btn{padding:.875rem 2rem;background:#000;color:#fff;border:none;border-radius:24px;font-size:1rem;font-weight:600;font-family:'Inter',sans-serif;cursor:pointer;transition:all .2s ease;}
    .back-to-puzzles-btn:hover{background:#333;}
    .back-to-puzzles-btn:active{transform:scale(.97);}

    /* iPhone Call Screen */
    .win-screen{position:fixed;inset:0;width:100%;height:100%;min-height:100vh;min-height:-webkit-fill-available;background:#1c1c1e;z-index:10001;display:none;}
    .win-screen.show{display:block;}
    .iphone-call{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:3rem 2rem;color:#fff;}
    .call-info{text-align:center;margin-top:4rem;}
    .caller-name{font-size:2.5rem;margin-bottom:.75rem;font-weight:400;font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;}
    .call-status{font-size:1.125rem;color:#a1a1a1;font-weight:400;}

    .call-actions{display:flex;gap:4rem;margin-bottom:3rem;}
    .call-action{display:flex;flex-direction:column;align-items:center;gap:.5rem;color:#fff;}
    .action-icon{width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:1.5rem;}
    .action-label{font-size:.875rem;color:#a1a1a1;}

    .slide-to-answer{width:100%;max-width:350px;height:70px;background:rgba(120,120,128,.36);border-radius:35px;position:relative;overflow:hidden;margin-bottom:2rem;user-select:none;}
    .slide-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:1.15rem;white-space:nowrap;pointer-events:none;}
    .slide-button{position:absolute;left:5px;top:5px;width:60px;height:60px;background:linear-gradient(135deg, #34c759, #30d158);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;cursor:grab;touch-action:none;z-index:2;}
    .slide-button:active{cursor:grabbing;}

    /* Reveal */
    .wetlands-reveal{position:fixed;inset:0;width:100%;height:100%;min-height:100vh;min-height:-webkit-fill-available;background:#fff;z-index:10002;display:none;flex-direction:column;align-items:center;justify-content:center;padding:0;}
    .wetlands-reveal.show{display:flex;}
    .wetlands-reveal img{width:100%;height:100%;object-fit:cover;}
    .end-call-btn{position:absolute;bottom:4rem;left:50%;transform:translateX(-50%);padding:.875rem 2rem;background:#007AFF;color:#fff;border:none;border-radius:24px;font-size:1rem;font-weight:600;font-family:'Inter',sans-serif;cursor:pointer;text-decoration:none;display:inline-block;transition:all .2s ease;z-index:10;}
    .end-call-btn:hover{background:#0051D5;}
    .end-call-btn:active{transform:translateX(-50%) scale(.97);}
  
.close-victory{
  position:absolute;
  top:10px;
  right:14px;
  background:none;
  border:none;
  font-size:14px;
  color:rgba(0,0,0,0.35);
  cursor:pointer;
  padding:4px;
  transition:opacity .2s ease, transform .2s ease;
}
.close-victory:hover{
  opacity:0.6;
  transform:scale(1.1);
}
.victory-content{ position:relative; }

</style>
</head>

<body>
  <div class="header">
    <a href="index.html" class="back-btn">
      <span>&#8249;</span>
      <span class="back-text">Back to games</span>
    </a>
  </div>

  <div class="puzzle-container">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js">
document.getElementById("closeVictory")?.addEventListener("click", () => {
  document.getElementById("victoryPopup").classList.remove("show");
});

</script>
    <script id="pm-script" src="https://puzzleme.amuselabs.com/pmm/js/puzzleme-embed.js">
document.getElementById("closeVictory")?.addEventListener("click", () => {
  document.getElementById("victoryPopup").classList.remove("show");
});

</script>
    <script>
      PM_Config.PM_BasePath = "https://puzzleme.amuselabs.com/pmm/";
    
document.getElementById("closeVictory")?.addEventListener("click", () => {
  document.getElementById("victoryPopup").classList.remove("show");
});

</script>

    <div class="pm-embed-div"
      data-id="c68cc624"
      data-set="68dd1991382a40a36c84960cc380ca2bcd67eafa9bb34193069a6eb5720ef3d5"
      data-puzzletype="crossword"
      data-height="700px"
      data-mobilemargin="10px"></div>
  </div>

  <!-- Victory Popup -->
  <div id="victoryPopup" class="victory-popup">
    <div class="victory-content">
<button id="closeVictory" class="close-victory">âœ•</button>

      <div class="victory-message">Congratulations!</div>
      <button class="back-to-puzzles-btn" id="showPhoneBtn">Back to puzzles</button>
    </div>
  </div>

  <!-- iPhone Call Screen -->
  <div id="winScreen" class="win-screen">
    <div class="iphone-call">
      <div class="call-info">
        <div class="caller-name">ðŸ’§</div>
        <div class="call-status">answer quickly</div>
      </div>

      <div class="call-actions">
        <div class="call-action">
          <div class="action-icon">ðŸ””</div>
          <div class="action-label">Remind Me</div>
        </div>
        <div class="call-action">
          <div class="action-icon">ðŸ’¬</div>
          <div class="action-label">Message</div>
        </div>
      </div>

      <div class="slide-to-answer" id="slideToAnswer">
        <div class="slide-text" id="slideText">
          <span style="font-weight:600;">slide</span>
          <span style="opacity:.6;"> to answer</span>
        </div>
        <div class="slide-button" id="slideButton">ðŸ“ž</div>
      </div>
    </div>
  </div>

  <!-- Wetlands Reveal -->
  <div id="wetlandsReveal" class="wetlands-reveal">
    <img src="wetlandscongratulations.png" alt="Wetlands congratulations" />
    <a href="index.html" class="end-call-btn">End Call</a>
  </div>

  <!-- Victory Music -->
  <audio id="victoryMusic" preload="auto">
    <source src="asslikethat.mp3" type="audio/mpeg" />
  </audio>

  <script>
    /**
     * âœ… Robust PuzzleMe completion detection.
     * Why this version: in some setups, event.data can arrive as a JSON STRING, not an object.
     * This listener logs everything so you can see the exact payload and origin in DevTools.
     *
     * Docs: https://amuselabs.com/docs/integration/iframe-communication/
     */
    window.addEventListener("message", (event) => {
      // Helpful while debugging:
      // You should see messages like PUZZLE_LOAD, PUZZLE_SIZE_CHANGE, PUZZLE_COMPLETE, etc.
      let data = event.data;

      // If PuzzleMe sends a JSON string, parse it.
      if (typeof data === "string") {
        try { data = JSON.parse(data); } catch { /* leave as string */ }
      }

      // Log every message so you can confirm it's working
      console.log("ðŸ“© postMessage received:", { origin: event.origin, data });

      // SECURITY: once you confirm the real origin in the console, lock this down.
      // For now, allow any amuse labs subdomain.
      const isAllowed =
        typeof event.origin === "string" &&
        (event.origin === "https://puzzleme.amuselabs.com" ||
         event.origin.endsWith(".amuselabs.com"));

      if (!isAllowed) return;

      if (!data || typeof data !== "object") return;

      // Trigger when puzzle is completed correctly
      if (data.type === "PUZZLE_COMPLETE" && data.completedCorrectly) {
        console.log("ðŸŽ‰ Puzzle completed correctly!");
        setTimeout(() => {
          document.getElementById("victoryPopup").classList.add("show");
        }, 250);
      }

      // Optional alternative: if you want to wait until their completion modal is dismissed
      // if (data.type === "PUZZLE_COMPLETION_MODAL_DISMISSED") { ... }
    });

    // Phone flow
    document.getElementById("showPhoneBtn").addEventListener("click", () => {
      document.getElementById("victoryPopup").classList.remove("show");
      document.getElementById("winScreen").classList.add("show");
      setupPhoneSlider();
    });

    function setupPhoneSlider() {
      const slider = document.getElementById("slideToAnswer");
      const button = document.getElementById("slideButton");
      const text = document.getElementById("slideText");

      let isDragging = false;
      let startX = 0;

      const handleStart = (e) => {
        isDragging = true;
        startX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
        button.style.transition = "none";
      };

      const handleMove = (e) => {
        if (!isDragging) return;
        e.preventDefault();

        const clientX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
        const deltaX = clientX - startX;
        const maxSlide = slider.offsetWidth - button.offsetWidth - 10;

        const currentX = Math.max(0, Math.min(deltaX, maxSlide));
        button.style.left = currentX + "px";
        text.style.opacity = 1 - (currentX / maxSlide);

        if (currentX > maxSlide * 0.8) answerCall();
      };

      const handleEnd = () => {
        if (!isDragging) return;
        isDragging = false;
        button.style.transition = "left 0.3s ease";
        button.style.left = "5px";
        text.style.opacity = 1;
      };

      const answerCall = () => {
        isDragging = false;
        document.getElementById("winScreen").classList.remove("show");
        document.getElementById("wetlandsReveal").classList.add("show");
        const music = document.getElementById("victoryMusic");
        music.currentTime = 0;
        music.play().catch(() => {
          document.getElementById("wetlandsReveal").addEventListener("click", () => {
            music.play().catch(() => {});
          }, { once: true });
        });
      };

      button.addEventListener("mousedown", handleStart);
      document.addEventListener("mousemove", handleMove);
      document.addEventListener("mouseup", handleEnd);

      button.addEventListener("touchstart", handleStart);
      document.addEventListener("touchmove", handleMove, { passive: false });
      document.addEventListener("touchend", handleEnd);
    }
  
document.getElementById("closeVictory")?.addEventListener("click", () => {
  document.getElementById("victoryPopup").classList.remove("show");
});

</script>
</body>
</html>
